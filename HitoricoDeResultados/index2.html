<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Histórico de Resultados Lotofácil</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 1200px;
            width: 100%;
        }

        .result {
            margin-bottom: 20px;
            display: inline-block;
            width: 30%;
            vertical-align: top;
        }

        .result h3 {
            margin-bottom: 10px;
            font-size: 14px;
            text-align: center;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 3px;
        }

        .number {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ccc;
            border-radius: 50%;
            background-color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .highlight {
            background-color: #930089;
            color: white;
            border-color: #930089;
        }

        .loading {
            display: none;
            margin: 20px 0;
        }

        .loading.active {
            display: block;
        }

        .error {
            color: red;
            margin-top: 10px;
        }

        button {
            padding: 8px 16px;
            background-color: #930089;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #6b0063;
        }

        .game-container {
            border: 1px solid #002;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            background-color: #fff;
        }

        .column-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            background-color: #fff;
        }

        .row {
            display: flex;
            justify-content: space-between;
            width: 80px;
            margin-bottom: 5px;
        }

        .number {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ccc;
            border-radius: 50%;
            font-size: 12px;
            background-color: white;
            font-weight: bold;
        }

        .highlight {
            background-color: #930089;
            color: white;
            border-color: #930089;
        }

        progress {
            width: 100%;
            height: 20px;
            margin-top: 20px;
            position: relative;
        }

        progress::-webkit-progress-bar {
            background-color: #f3f3f3;
            border-radius: 10px;
        }

        progress::-webkit-progress-value {
            background-color: #930089;
            border-radius: 10px;
        }

        progress::-moz-progress-bar {
            background-color: #930089;
            border-radius: 10px;
        }

        .progress-text {
            position: absolute;
            width: 100%;
            text-align: center;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .progress-percentage {
            margin-top: 10px;
            font-size: 16px;
            font-weight: bold;
            color: #930089;
        }

        .summary {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            color: #930089;
        }

        .summary-table {
            width: 100%;
            margin-top: 10px;
            border-collapse: collapse;
        }

        .summary-table th, .summary-table td {
            padding: 8px;
            border: 1px solid #ccc;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Histórico de Resultados Lotofácil</h2>

        <label for="maxConcursos">Número máximo de concursos a carregar:</label>
        <input type="number" id="maxConcursos" value="100" min="1" style="margin-right: 10px;">

        <span id="ultimoConcurso" style="font-weight: bold; color: #930089;">Carregando o último concurso...</span>
        
        <br><br>
        <button id="loadResults">Carregar Resultados</button>

        <!-- Barra de Progresso -->
        <progress id="progressBar" value="0" max="100">
            <span id="progressText" class="progress-text">0%</span>
        </progress>

        <!-- Texto da porcentagem abaixo da barra de progresso -->
        <div id="progressPercentage" class="progress-percentage">0%</div>

        <div id="loading" class="loading">Carregando resultados...</div>
        <div id="error" class="error"></div>
        <div id="results"></div>
    </div>

    <script>
        let ultimoConcurso = 0;

        async function fetchUltimoConcurso() {
            const baseUrl = 'https://loteriascaixa-api.herokuapp.com/api/lotofacil';
            const ultimoConcursoSpan = document.getElementById('ultimoConcurso');

            try {
                const response = await fetch(`${baseUrl}/latest`);
                if (!response.ok) {
                    throw new Error('Erro ao buscar o último concurso.');
                }

                const data = await response.json();
                ultimoConcurso = data.concurso;
                ultimoConcursoSpan.textContent = `Último concurso disponível: ${ultimoConcurso}`;
            } catch (err) {
                ultimoConcursoSpan.textContent = 'Erro ao carregar o último concurso.';
                console.error(err);
            }
        }

        async function fetchResults() {
            const resultsContainer = document.getElementById('results');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const maxConcursosInput = document.getElementById('maxConcursos');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const progressPercentage = document.getElementById('progressPercentage');

            loading.classList.add('active');
            error.textContent = '';
            resultsContainer.innerHTML = '';

            const GrupoPar = [2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24];
            const relatorioPar = [];
            const rankingNaoSorteados = {};
            const duplas = {};
            const triplas = {};
            const sequencias = {};

            GrupoPar.forEach(num => (rankingNaoSorteados[num] = 0));

            const baseUrl = 'https://loteriascaixa-api.herokuapp.com/api/lotofacil';
            let concurso = 1;

            const maxConcursos = parseInt(maxConcursosInput.value) || 100;

            try {
                while (concurso <= maxConcursos) {
                    const url = `${baseUrl}/${concurso}`;
                    const response = await fetch(url);

                    if (!response.ok) {
                        if (response.status === 404) {
                            break;
                        } else {
                            throw new Error('Erro ao buscar os resultados.');
                        }
                    }

                    const data = await response.json();
                    const dezenas = data.dezenas.map(Number);

                    // Atualizando duplas e triplas somente para os números pares do GrupoPar
                    const paresSorteados = dezenas.filter(num => GrupoPar.includes(num));

                    for (let i = 0; i < paresSorteados.length; i++) {
                        for (let j = i + 1; j < paresSorteados.length; j++) {
                            const dupla = [paresSorteados[i], paresSorteados[j]].sort().join(',');
                            duplas[dupla] = duplas[dupla] ? duplas[dupla] + 1 : 1;
                        }

                        for (let j = i + 1; j < paresSorteados.length; j++) {
                            for (let k = j + 1; k < paresSorteados.length; k++) {
                                const tripla = [paresSorteados[i], paresSorteados[j], paresSorteados[k]].sort().join(',');
                                triplas[tripla] = triplas[tripla] ? triplas[tripla] + 1 : 1;
                            }
                        }
                    }

                    // Verificando sequências somente para os números pares do GrupoPar
                    for (let i = 0; i < paresSorteados.length - 2; i++) {
                        const seq = [paresSorteados[i], paresSorteados[i + 1], paresSorteados[i + 2]].sort().join(',');
                        sequencias[seq] = sequencias[seq] ? sequencias[seq] + 1 : 1;
                    }

                    // Ranking dos números não sorteados para os pares
                    const naoSorteadosPar = GrupoPar.filter(num => !dezenas.includes(num));
                    naoSorteadosPar.forEach(num => rankingNaoSorteados[num]++);

                    if (naoSorteadosPar.length > 0) {
                        relatorioPar.push({
                            concurso: data.concurso,
                            data: data.data,
                            naoSorteados: naoSorteadosPar
                        });
                    }

                    // Atualizando a barra de progresso
                    const progresso = Math.round((concurso / maxConcursos) * 100);
                    progressBar.value = progresso;
                    progressText.textContent = `${progresso}%`;
                    progressPercentage.textContent = `${progresso}%`;

                    concurso++;
                }

                const estatisticasDiv = document.createElement('div');
                estatisticasDiv.className = 'container';
                estatisticasDiv.innerHTML = '<h2>Estatísticas</h2>';

                // Tabela de Números Não Sorteados no GrupoPar
                const tabelaPar = `
                    <table border="1" style="margin: 20px; text-align: center; border-collapse: collapse; width: 100%;">
                        <thead>
                            <tr>
                                <th>Concurso</th>
                                <th>Data</th>
                                <th>Números Não Sorteados no GrupoPar</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${relatorioPar
                                .map(entry => `
                                    <tr>
                                        <td>${entry.concurso}</td>
                                        <td>${entry.data}</td>
                                        <td>${entry.naoSorteados.join(', ')}</td>
                                    </tr>
                                `).join('')}
                        </tbody>
                    </table>`;

                estatisticasDiv.innerHTML += tabelaPar;

                // Resumo Final
                const resumoFinal = `
                    <div class="summary">
                        <h3>Resumo Final - Top 1 em Duplas, Triplas e Sequências</h3>
                        <table class="summary-table">
                            <thead>
                                <tr>
                                    <th>Categoria</th>
                                    <th>Primeiro</th>
                                    <th>Quantidade</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Duplas</td>
                                    <td>${Object.entries(duplas).sort((a, b) => b[1] - a[1])[0][0]}</td>
                                    <td>${Object.entries(duplas).sort((a, b) => b[1] - a[1])[0][1]}</td>
                                </tr>
                                <tr>
                                    <td>Triplas</td>
                                    <td>${Object.entries(triplas).sort((a, b) => b[1] - a[1])[0][0]}</td>
                                    <td>${Object.entries(triplas).sort((a, b) => b[1] - a[1])[0][1]}</td>
                                </tr>
                                <tr>
                                    <td>Sequências</td>
                                    <td>${Object.entries(sequencias).sort((a, b) => b[1] - a[1])[0][0]}</td>
                                    <td>${Object.entries(sequencias).sort((a, b) => b[1] - a[1])[0][1]}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Ranking dos Números Não Sorteados -->
                    <div class="summary">
                        <h3>Resumo: Ranking dos Números Não Sorteados</h3>
                        <table class="summary-table">
                            <thead>
                                <tr>
                                    <th>Número</th>
                                    <th>Quantidade de Vezes Não Sorteado</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(rankingNaoSorteados).sort((a, b) => b[1] - a[1])
                                    .slice(0, 10)
                                    .map(([numero, quantidade]) => `
                                        <tr>
                                            <td>${numero}</td>
                                            <td>${quantidade}</td>
                                        </tr>
                                    `).join('')}
                            </tbody>
                        </table>
                    </div>`;

                estatisticasDiv.innerHTML += resumoFinal;
                resultsContainer.appendChild(estatisticasDiv);
            } catch (err) {
                error.textContent = 'Erro ao carregar os resultados.';
                console.error(err);
            } finally {
                loading.classList.remove('active');
            }
        }

        document.getElementById('loadResults').addEventListener('click', fetchResults);

        fetchUltimoConcurso();
    </script>
</body>
</html>
