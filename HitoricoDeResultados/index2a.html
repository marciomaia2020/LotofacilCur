<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Histórico de Resultados Lotofácil</title>
    <style>
        /* Existing styles... */
    </style>
</head>
<body>
    <div class="container">
        <h2>Histórico de Resultados Lotofácil</h2>

        <label for="maxConcursos">Número máximo de concursos a carregar:</label>
        <input type="number" id="maxConcursos" value="100" min="1" style="margin-right: 10px;">

        <label for="sortField">Ordenar por:</label>
        <select id="sortField">
            <option value="concurso">Concurso</option>
            <option value="data">Data</option>
            <option value="grupoPar">Grupo Par</option>
        </select>

        <label for="sortOrder">Ordem:</label>
        <select id="sortOrder">
            <option value="asc">Crescente</option>
            <option value="desc">Decrescente</option>
        </select>

        <span id="ultimoConcurso" style="font-weight: bold; color: #930089;">Carregando o último concurso...</span>
        
        <br><br>
        <button id="loadResults">Carregar Resultados</button>

        <!-- Barra de Progresso -->
        <progress id="progressBar" value="0" max="100">
            <span id="progressText" class="progress-text">0%</span>
        </progress>

        <!-- Texto da porcentagem abaixo da barra de progresso -->
        <div id="progressPercentage" class="progress-percentage">0%</div>

        <div id="loading" class="loading">Carregando resultados...</div>
        <div id="error" class="error"></div>
        <div id="results"></div>
    </div>

    <script>
        let ultimoConcurso = 0;

        async function fetchUltimoConcurso() {
            const baseUrl = 'https://loteriascaixa-api.herokuapp.com/api/lotofacil';
            const ultimoConcursoSpan = document.getElementById('ultimoConcurso');

            try {
                const response = await fetch(`${baseUrl}/latest`);
                if (!response.ok) {
                    throw new Error('Erro ao buscar o último concurso.');
                }

                const data = await response.json();
                ultimoConcurso = data.concurso;
                ultimoConcursoSpan.textContent = `Último concurso disponível: ${ultimoConcurso}`;
            } catch (err) {
                ultimoConcursoSpan.textContent = 'Erro ao carregar o último concurso.';
                console.error(err);
            }
        }

        async function fetchResults() {
            const resultsContainer = document.getElementById('results');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const maxConcursosInput = document.getElementById('maxConcursos');
            const sortFieldSelect = document.getElementById('sortField');
            const sortOrderSelect = document.getElementById('sortOrder');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const progressPercentage = document.getElementById('progressPercentage');

            loading.classList.add('active');
            error.textContent = '';
            resultsContainer.innerHTML = '';

            const GrupoPar = [2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24];
            const relatorioPar = [];
            // Other variables...

            const baseUrl = 'https://loteriascaixa-api.herokuapp.com/api/lotofacil';
            let concurso = 1;
            const maxConcursos = parseInt(maxConcursosInput.value) || 100;

            try {
                while (concurso <= maxConcursos) {
                    // Fetching logic...
                    // Populate relatorioPar array...

                    concurso++;
                }

                // Sorting results based on selected field and order
                const sortField = sortFieldSelect.value;
                const sortOrder = sortOrderSelect.value;

                relatorioPar.sort((a, b) => {
                    if (sortField === 'concurso') {
                        return sortOrder === 'asc' ? a.concurso - b.concurso : b.concurso - a.concurso;
                    } else if (sortField === 'data') {
                        return sortOrder === 'asc' ? new Date(a.data) - new Date(b.data) : new Date(b.data) - new Date(a.data);
                    } else if (sortField === 'grupoPar') {
                        // Assuming grupoPar is an array of numbers
                        return sortOrder === 'asc' ? a.naoSorteados.length - b.naoSorteados.length : b.naoSorteados.length - a.naoSorteados.length;
                    }
                });

                // Display sorted results...
                
                loading.classList.remove('active');
            } catch (err) {
                error.textContent = 'Erro ao carregar os resultados.';
                console.error(err);
                loading.classList.remove('active');
            }
        }

        document.getElementById('loadResults').addEventListener('click', fetchResults);

        fetchUltimoConcurso();
    </script>
</body>
</html>
